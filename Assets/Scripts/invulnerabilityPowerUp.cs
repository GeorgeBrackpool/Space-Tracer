using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;
using TMPro;

public class invulnerabilityPowerUp : MonoBehaviour
{
  
    public float duration = 2f;
    Rigidbody2D invulnRB;
    public int invulnBuff = 999999;
    public bool isInvincible;
    HealthDisplay healthDisplay;
    InvulnerabilityDisplay invulnerabilityDisplay;
    [SerializeField] int restoreHealthBy = 50;
    int prePowerUpHealth;

    GameSession gameSession;
   public void OnTriggerEnter2D(Collider2D other) 
    {
      if (other.CompareTag("Player"))
      {
       
        StartCoroutine(Pickup(other)); 
        
        
      }
  }
  IEnumerator Pickup(Collider2D player)
  {   
    FindObjectOfType<GameSession>().powerupCounter++;
    FingerMovement playerInvuln = player.GetComponent<FingerMovement>();
    invulnerabilityDisplay = FindObjectOfType<InvulnerabilityDisplay>();
    healthDisplay = FindObjectOfType<HealthDisplay>();
    invulnRB=GetComponent<Rigidbody2D>();
    prePowerUpHealth = playerInvuln.health;
    
     isInvincible = true;
    if (isInvincible == true){
      playerInvuln.health += invulnBuff; 
    }
    healthDisplay.GetComponent<Text>().enabled = false;
    invulnerabilityDisplay.GetComponent<TextMeshProUGUI>().enabled = true;
    invulnRB.constraints = RigidbodyConstraints2D.FreezePositionY;
    
    GetComponent<SpriteRenderer>().enabled = false;
    GetComponent<BoxCollider2D>().enabled = false;
     yield return new WaitForSeconds(duration);
      isInvincible = false;
        invulnerabilityDisplay.GetComponent<TextMeshProUGUI>().enabled = false;
       
   
        if (prePowerUpHealth < 500)
        {
            playerInvuln.health = prePowerUpHealth + restoreHealthBy; // Give the player 50 health if health not at max health.
        }
        else if(prePowerUpHealth >= 500)
        {
            playerInvuln.health = prePowerUpHealth;
        }
        healthDisplay.GetComponent<Text>().enabled = true;
        Destroy(gameObject);
    }
}    
  


